platform :ios, '13.0'

ENV['COCOAPODS_DISABLE_STATS'] = 'true'

def flutter_root
  `flutter --version --machine`.then do |json_str|
    require 'json'
    json = JSON.parse(json_str)
    return json["flutterRoot"] if json.key?("flutterRoot")
    # fallback or raise error if not found
    raise "Flutter root not found"
  end
end

flutter_root = `flutter --version --machine`.then do |json_str|
  require 'json'
  json = JSON.parse(json_str)
  json["flutterRoot"] if json.key?("flutterRoot")
end

unless flutter_root && !flutter_root.empty?
  raise "Could not find flutter SDK path"
end

load File.join(flutter_root, 'packages', 'flutter_tools', 'bin', 'podhelper.rb')

target 'Runner' do
  use_frameworks!
  use_modular_headers!

  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))
end

